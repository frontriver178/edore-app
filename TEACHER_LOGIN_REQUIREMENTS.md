# 講師ログイン機能 要件定義書

## 概要

講師がシステムに直接ログインして、担当生徒の情報管理や指導記録の入力を行える機能を実装する。

## 目的

- 講師が独立してシステムを利用できるようにする
- 管理者の負担を軽減し、講師の自律性を向上させる
- リアルタイムでの指導記録入力と情報共有を実現する

## ユーザーストーリー

### 管理者として
- 講師アカウントを作成し、ログイン情報を講師に提供したい
- 講師の権限を管理し、アクセス範囲を制御したい
- 講師のアクティビティを監視したい

### 講師として
- 自分専用のアカウントでログインしたい
- 担当生徒の情報を確認・更新したい
- 指導記録を入力・管理したい
- 面談記録を入力・管理したい
- スケジュール管理を行いたい

## 機能要件

### 1. 講師アカウント管理

#### 1.1 講師登録機能
- **実装者**: 管理者
- **機能**: 講師管理画面から講師アカウントを作成
- **必要項目**:
  - 名前 (必須)
  - メールアドレス (必須、ログインID)
  - 電話番号
  - 担当科目 (複数選択可)
  - ステータス (active/inactive)
  - プロフィール

#### 1.2 ログイン認証機能
- **認証方式**: Supabase Auth（メール・パスワード）
- **初期パスワード**: システム生成またはメール招待
- **パスワードリセット**: メール経由でのリセット機能

#### 1.3 権限管理
- **role**: 'teacher'
- **アクセス範囲**: 自分が担当する生徒のみ
- **機能制限**: 
  - 他の講師情報の閲覧不可
  - 組織設定の変更不可
  - ユーザー管理機能へのアクセス不可

### 2. 講師専用画面

#### 2.1 講師ダッシュボード
- **担当生徒一覧**: 自分が担当する生徒のリスト
- **今日の予定**: 本日の面談・指導スケジュール
- **未完了タスク**: 記録未入力の指導・面談
- **通知**: 管理者からのお知らせ

#### 2.2 生徒情報管理
- **閲覧権限**: 担当生徒の詳細情報
- **編集権限**: 指導記録、成績、備考の追加・編集
- **制限事項**: 基本情報（名前、学年等）の変更は不可

#### 2.3 指導記録管理
- **新規作成**: 指導後の記録入力
- **編集・更新**: 過去の記録の修正
- **検索・フィルタ**: 日付、生徒、科目での絞り込み

#### 2.4 面談記録管理
- **新規作成**: 面談後の記録入力
- **編集・更新**: 過去の記録の修正
- **保護者共有**: 必要に応じて保護者と記録を共有

#### 2.5 スケジュール管理
- **予定確認**: 自分の指導・面談スケジュール
- **ステータス更新**: 予定の完了・キャンセル処理
- **制限事項**: 新規スケジュール作成は管理者のみ

### 3. データベース設計

#### 3.1 usersテーブル拡張
```sql
-- 既存のusersテーブルに追加カラム
ALTER TABLE users ADD COLUMN IF NOT EXISTS password_reset_token TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS password_reset_expires TIMESTAMPTZ;
ALTER TABLE users ADD COLUMN IF NOT EXISTS last_login TIMESTAMPTZ;
ALTER TABLE users ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true;
```

#### 3.2 teacher_students（講師-生徒関連テーブル）
```sql
CREATE TABLE teacher_students (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  teacher_id UUID REFERENCES users(id) ON DELETE CASCADE,
  student_id UUID REFERENCES students(id) ON DELETE CASCADE,
  subject TEXT,
  assigned_at TIMESTAMPTZ DEFAULT NOW(),
  is_active BOOLEAN DEFAULT true,
  organization_id UUID REFERENCES organizations(id),
  UNIQUE(teacher_id, student_id, subject)
);
```

#### 3.3 RLS（Row Level Security）ポリシー
```sql
-- 講師は自分が担当する生徒のみアクセス可能
CREATE POLICY teacher_students_policy ON students
FOR ALL TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM teacher_students ts
    WHERE ts.student_id = students.id
    AND ts.teacher_id = auth.uid()
    AND ts.is_active = true
  )
  OR
  EXISTS (
    SELECT 1 FROM users
    WHERE id = auth.uid()
    AND role = 'admin'
  )
);
```

## 技術要件

### 4.1 認証・認可
- **認証**: Supabase Auth
- **セッション管理**: JWT Token
- **パスワード要件**: 
  - 最低8文字
  - 英数字組み合わせ
  - 特殊文字推奨

### 4.2 セキュリティ
- **データアクセス**: RLS によるデータ分離
- **APIセキュリティ**: 認証済みユーザーのみアクセス可能
- **ログ管理**: ログイン履歴、操作ログの記録

### 4.3 UI/UX
- **レスポンシブ対応**: モバイル・タブレット対応
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **多言語対応**: 日本語のみ（将来的に英語対応）

## 非機能要件

### 5.1 パフォーマンス
- **レスポンス時間**: 2秒以内
- **同時アクセス**: 50ユーザー
- **データ更新**: リアルタイム反映

### 5.2 可用性
- **稼働率**: 99.5%以上
- **メンテナンス時間**: 月1回、夜間実施

### 5.3 拡張性
- **ユーザー数**: 500名まで対応
- **データ量**: 10GB まで対応

## 実装フェーズ

### フェーズ1: 基本機能（2週間）
1. 講師アカウント作成機能
2. ログイン・認証機能
3. 基本的な講師ダッシュボード
4. 担当生徒一覧表示

### フェーズ2: 記録管理機能（2週間）
1. 指導記録の入力・編集
2. 面談記録の入力・編集
3. 記録の検索・フィルタ機能

### フェーズ3: 高度な機能（1週間）
1. スケジュール管理機能
2. 通知機能
3. レポート機能

## リスク管理

### 技術的リスク
- **データ分離の実装複雑性**: RLSポリシーの設計が重要
- **認証システムの統合**: Supabase Authとの連携

### 運用リスク
- **講師への説明・研修**: 新システムの操作方法
- **データ移行**: 既存データとの整合性

## 成功指標

### 定量的指標
- 講師ログイン率: 90%以上
- 記録入力の完了率: 95%以上
- システム満足度: 4.0/5.0以上

### 定性的指標
- 管理者の作業負荷軽減
- 講師の自律性向上
- 情報共有の質向上

## 今後の拡張予定

1. **モバイルアプリ**: スマートフォン専用アプリ
2. **AI機能**: 学習分析、推奨機能
3. **外部連携**: 他の教育システムとの連携
4. **保護者ポータル**: 保護者専用の情報閲覧機能

---

**作成日**: 2025年7月18日  
**更新日**: 2025年7月18日  
**作成者**: システム開発チーム  
**承認者**: プロジェクトマネージャー
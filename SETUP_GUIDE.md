# ğŸ¢ Edore ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“Œ æ¦‚è¦
ä»–å¡¾ã«ã‚‚è²©å£²ã™ã‚‹SaaSã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ã€ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆï¼ˆè¤‡æ•°çµ„ç¹”ï¼‰å¯¾å¿œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## ğŸ—‚ ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

### 1. **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œ**
- å„å¡¾ï¼ˆorganizationï¼‰ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨åˆ†é›¢
- Row Level Security (RLS) ã§ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- çµ„ç¹”IDã«ã‚ˆã‚‹è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### 2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†æ©Ÿèƒ½
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼‰
- å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µã«å¯¾å¿œ

### 3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- çµ„ç¹”é–“ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©é˜²æ­¢
- å½¹å‰²ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- è‡ªå‹•çš„ãªãƒ‡ãƒ¼ã‚¿åˆ†é›¢

---

## ğŸ›  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### **Step 1: Supabaseç®¡ç†ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹**
1. [Supabase Dashboard](https://supabase.com/dashboard) ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ: `edore-app`
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒSQL Editorã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### **Step 2: SQLã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ**
1. ã€Œ+ New queryã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. `database_setup.sql` ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
3. ã€ŒRunã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Ÿè¡Œ

### **Step 3: å®Ÿè¡Œçµæœç¢ºèª**
ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
- âœ… organizations (çµ„ç¹”æƒ…å ±)
- âœ… users (ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±)  
- âœ… students (ç”Ÿå¾’æƒ…å ±)
- âœ… interviews (é¢è«‡è¨˜éŒ²)
- âœ… tasks (å­¦ç¿’ã‚¿ã‚¹ã‚¯)
- âœ… materials (æ•™æç®¡ç†)
- âœ… scores (æˆç¸¾)

### **Step 4: ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç¢ºèª**
1. ã€ŒTable Editorã€ã‹ã‚‰å„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç¢ºèª
2. ã‚µãƒ³ãƒ—ãƒ«çµ„ç¹”ã¨ã‚µãƒ³ãƒ—ãƒ«ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ” Row Level Security (RLS) è¨­å®šå†…å®¹

### **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**
- **çµ„ç¹”ç®¡ç†è€…ã®ã¿çµ„ç¹”è¨­å®šã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**
- **è‡ªå‹•çš„ãªçµ„ç¹”ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**

### **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ä¾‹**
```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®çµ„ç¹”ã®ç”Ÿå¾’ãƒ‡ãƒ¼ã‚¿ã®ã¿å‚ç…§å¯èƒ½
CREATE POLICY "Students organization access" ON students
    FOR ALL USING (
        organization_id IN (
            SELECT organization_id FROM users WHERE id = auth.uid()
        )
    );
```

---

## ğŸš€ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å®Ÿè£…

### **Step 5: çµ„ç¹”é¸æŠæ©Ÿèƒ½ã®è¿½åŠ **
æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã«ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’è¿½åŠ ï¼š

1. **çµ„ç¹”é¸æŠãƒšãƒ¼ã‚¸** - æ–°è¦å¡¾ã®ç™»éŒ²
2. **ç®¡ç†è€…ç™»éŒ²ãƒ•ãƒ­ãƒ¼** - åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
3. **æ‹›å¾…æ©Ÿèƒ½** - è¬›å¸«ãƒ»ç”Ÿå¾’ã®æ‹›å¾…

### **Step 6: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã®æ”¹å–„**
```javascript
// çµ„ç¹”ç®¡ç†è€…ã®åˆå›ç™»éŒ²
const createOrganizationAndAdmin = async (orgData, userData) => {
  // 1. çµ„ç¹”ä½œæˆ
  const { data: org } = await supabase
    .from('organizations')
    .insert(orgData)
    .select()
    .single()
  
  // 2. ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
  await supabase
    .from('users')
    .insert({
      id: user.id,
      organization_id: org.id,
      role: 'admin',
      name: userData.name
    })
}
```

---

## ğŸ“Š é‹ç”¨ãƒ•ãƒ­ãƒ¼

### **æ–°è¦å¡¾ã®ç™»éŒ²ãƒ•ãƒ­ãƒ¼**
1. **å¡¾ç®¡ç†è€…ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ**
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š
   
2. **çµ„ç¹”æƒ…å ±ç™»éŒ²**
   - å¡¾åã€é€£çµ¡å…ˆã€ä½æ‰€ç­‰
   
3. **ç®¡ç†è€…æƒ…å ±ç™»éŒ²**
   - ç®¡ç†è€…åã€å½¹å‰²è¨­å®š
   
4. **è¬›å¸«ãƒ»ç”Ÿå¾’ã®æ‹›å¾…**
   - ãƒ¡ãƒ¼ãƒ«æ‹›å¾…æ©Ÿèƒ½
   - ä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½

### **æ—¥å¸¸é‹ç”¨ãƒ•ãƒ­ãƒ¼**
1. **è¬›å¸«ãƒ­ã‚°ã‚¤ãƒ³** â†’ æ‹…å½“ç”Ÿå¾’ã®ç®¡ç†
2. **ç”Ÿå¾’ãƒ­ã‚°ã‚¤ãƒ³** â†’ è‡ªåˆ†ã®èª²é¡Œãƒ»æˆç¸¾ç¢ºèª
3. **ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³** â†’ å…¨ä½“ç®¡ç†ãƒ»è¨­å®š

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### **ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•**

#### 1. **çµ„ç¹”æƒ…å ±ãŒå–å¾—ã§ããªã„**
```sql
-- ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ„ç¹”IDç¢ºèª
SELECT u.organization_id, o.name 
FROM users u 
JOIN organizations o ON u.organization_id = o.id 
WHERE u.id = auth.uid();
```

#### 2. **RLSã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹**
```sql
-- RLSè¨­å®šç¢ºèª
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE tablename IN ('students', 'users', 'organizations');
```

#### 3. **ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒusersãƒ†ãƒ¼ãƒ–ãƒ«ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- æ­£ã—ã„organization_idãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

---

## ğŸ“ˆ ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### **Phase 2: é«˜åº¦ãªæ©Ÿèƒ½**
- ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½
- ğŸ“§ è‡ªå‹•é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
- ğŸ’° è«‹æ±‚ãƒ»æ±ºæ¸ˆæ©Ÿèƒ½
- ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªå¯¾å¿œ

### **Phase 3: AIæ©Ÿèƒ½**
- ğŸ¤– å­¦ç¿’åˆ†æAI
- ğŸ“ è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ğŸ¯ å€‹åˆ¥å­¦ç¿’ãƒ—ãƒ©ãƒ³ææ¡ˆ

---

## ğŸ’¡ å‚è€ƒãƒªãƒ³ã‚¯
- [Supabase Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)
- [ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆè¨­è¨ˆ](https://supabase.com/docs/guides/auth/auth-helpers/auth-ui)
- [PostgreSQL ãƒãƒªã‚·ãƒ¼è¨­å®š](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) 